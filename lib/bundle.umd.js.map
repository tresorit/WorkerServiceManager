{"version":3,"file":"bundle.umd.js","sources":["../src/messageTransformers/defaultMessageTransformer.ts","../src/port/IPortHandler.ts","../src/deferredPromise.ts","../src/port/BasicPortHandler.ts","../src/port/AsyncPortHandler.ts","../src/port/LazyPortHandler.ts","../src/serviceMap.ts","../src/messageTransformers/autoTransferrableMessageTransformer.ts","../src/multiRemoteService.ts","../src/port/WorkerGlobalPortHandler.ts","../src/remoteService.ts","../src/workerServiceManager.ts"],"sourcesContent":["import { IMessageTransformer, Transferable } from \"./IMessageTransformer\";\n\nfunction transformError(err) {\n  return {\n    message: err.message,\n    name: err.name,\n    stack: err.stack,\n  };\n}\n\nexport class DefaultMessageTransformer implements IMessageTransformer {\n  public transformMessage(message: any): [any, Transferable[]] {\n    return [this.transform(message, new Map<any, boolean>())[0], []];\n  }\n\n  private transform(message: any, copies: Map<any, any>): [any, boolean] {\n    if (message && typeof message === \"object\") {\n      if (copies.has(message)) {\n        return [copies.get(message), true];\n      }\n\n      switch (Object.prototype.toString.call(message)) {\n        case \"[object ArrayBuffer]\":\n        case \"[object Uint8Array]\":\n        case \"[object Int8Array]\":\n        case \"[object Uint16Array]\":\n        case \"[object Int16Array]\":\n        case \"[object Uint32Array]\":\n        case \"[object Int32Array]\":\n        case \"[object Float32Array]\":\n        case \"[object Float64Array]\":\n          if (message.buffer.byteLength === message.byteLength) {\n            return [message, false];\n          }\n          const copy = new message.constructor(message);\n          copies.set(message, copy);\n          return [copy, true];\n        case \"[object Blob]\":\n        case \"[object File]\":\n          return [message, false];\n        case \"[object Array]\":\n          const arrRes = message.map((e) => this.transform(e, copies));\n          const copiedArr = arrRes.reduce((a, c) => a || c, false);\n\n          if (copiedArr) {\n            const copyArr = arrRes.map((a) => a[0]);\n            copies.set(message, copyArr);\n            return [copyArr, true];\n          }\n          return [message, false];\n        case \"[object Promise]\":\n        case \"[object XMLHttpRequest]\":\n        case \"[object Event]\":\n          throw new Error(\"CommunicationErrorNonMessageableValue\");\n        case \"[object DOMError]\":\n        case \"[object DOMException]\":\n          const copyDOMError = transformError(message);\n          copies.set(message, copyDOMError);\n          return [copyDOMError, true];\n        default:\n          if (message instanceof Error) {\n            const copyError = transformError(message);\n            copies.set(message, copyError);\n            return [copyError, true];\n          }\n\n          if (message instanceof Date) {\n            return [message, false];\n          }\n\n          const resObj = {};\n          for (const key of Object.keys(message)) {\n            if (!key.startsWith(\"_\")) {\n              const cRes = this.transform(message[key], copies);\n              resObj[key] = cRes[0];\n            }\n          }\n          copies.set(message, resObj);\n          return [resObj, true];\n      }\n    }\n    return [message, false];\n  }\n}\n","export interface IWorkerMessagePort {\n  onmessage: (event: MessageEvent) => void | Promise<void>;\n  terminate: () => void;\n\n  postMessage(data: any, transfers?: any[]): void;\n}\n\nexport function isPortHandler(portHandler: any): portHandler is IPortHandler {\n  return (portHandler as IPortHandler).terminate !== undefined &&\n    (portHandler as IPortHandler).setCallHandler !== undefined &&\n    (portHandler as IPortHandler).call !== undefined &&\n    (portHandler as IPortHandler).fire !== undefined;\n}\n\nexport interface IPortHandler {\n  terminate(): Promise<void>;\n\n  setCallHandler(handler): void;\n\n  call(service, method, args): Promise<any>;\n\n  fire(service, method, args): Promise<void>;\n}\n","export class DeferredPromise<T> {\n  public promise: Promise<T>;\n  public resolve: (value?: PromiseLike<T> | T) => void;\n  public reject: (reason?: any) => void;\n\n  constructor() {\n    this.promise = new Promise((res, rej) => {\n      this.resolve = res;\n      this.reject = rej;\n    });\n  }\n}\n","import { DeferredPromise } from \"../deferredPromise\";\nimport { IMessageTransformer, Transferable } from \"../messageTransformers/IMessageTransformer\";\nimport { IPortHandler, IWorkerMessagePort } from \"./IPortHandler\";\n\nenum PortCommands {\n  call,\n  fire,\n  resolve,\n  reject,\n}\n\nexport class BasicPortHandler implements IPortHandler {\n  private callHandler: (service, method, args) => Promise<any>;\n  private deferreds: Map<number, DeferredPromise<any>>;\n  private nextPid: number;\n\n  constructor(protected port: IWorkerMessagePort | null, protected messageTransformer: IMessageTransformer) {\n    this.nextPid = 0;\n    this.deferreds = new Map<number, DeferredPromise<any>>();\n    this.callHandler = null;\n\n    if (this.port) {\n      this.port.onmessage = this.handleMessage.bind(this);\n    }\n  }\n\n  public async terminate(): Promise<void> {\n    const port = this.port;\n\n    port.onmessage = undefined;\n    port.terminate();\n\n    this.port = undefined;\n  }\n\n  public async call(service, method, args): Promise<any> {\n    const deferred = new DeferredPromise<any>();\n    const pid = this.nextPid++;\n    this.deferreds.set(pid, deferred);\n    const msg = this.messageTransformer.transformMessage(args);\n    try {\n      await this.postMessage([PortCommands.call, pid, service, method, msg[0]], msg[1]);\n    } catch (ex) {\n      deferred.reject(ex);\n    }\n    return deferred.promise;\n  }\n\n  public setCallHandler(handler): void {\n    if (this.callHandler !== null) throw new Error(\"Call handler already set\");\n    this.callHandler = handler;\n  }\n\n  public fire(service, method, args): Promise<void> {\n    const msg = this.messageTransformer.transformMessage(args);\n    return this.postMessage([PortCommands.fire, service, method, msg[0]], msg[1]);\n  }\n\n  protected async postMessage(msg: any, transferables: Transferable[]): Promise<void> {\n    if (!this.port) {\n      throw new Error(\"PortTerminated\");\n    }\n\n    this.port.postMessage(msg, transferables);\n  }\n\n  protected async handleMessage(ev: any): Promise<void> {\n    switch (ev.data[0]) { // cmd\n      case PortCommands.fire:\n        try {\n          // We intentionally ignore the result (and even the errors) of the call. This is rarely a good idea,\n          // but it is sometimes useful.\n          //noinspection JSIgnoredPromiseFromCall\n          this.callHandler(ev.data[2], ev.data[3], ev.data[4]);\n        } catch (ex) {\n          // We ignore errors during calls because we have no way to handle them.\n          // TODO: add an settable error handler/logger\n          // console.error(ex);\n        }\n        break;\n      case PortCommands.call:\n        try {\n          const res = await this.callHandler(\n            ev.data[2],\n            ev.data[3],\n            ev.data[4],\n          );\n          const msg = this.messageTransformer.transformMessage(res);\n          await this.postMessage([PortCommands.resolve, ev.data[1], msg[0]], msg[1]);\n        } catch (ex) {\n          const msg = this.messageTransformer.transformMessage(ex);\n          await this.postMessage([PortCommands.reject, ev.data[1], msg[0]], msg[1]);\n        }\n        break;\n      case PortCommands.resolve:\n        this.deferreds.get(ev.data[1]).resolve(ev.data[2]);\n        this.deferreds.delete(ev.data[1]);\n        break;\n      case PortCommands.reject:\n        this.deferreds.get(ev.data[1]).reject(ev.data[2]);\n        this.deferreds.delete(ev.data[1]);\n        break;\n    }\n  }\n}\n","import { IMessageTransformer, Transferable } from \"../messageTransformers/IMessageTransformer\";\nimport { BasicPortHandler } from \"./BasicPortHandler\";\nimport { IWorkerMessagePort } from \"./IPortHandler\";\n\nexport class AsyncPortHandler extends BasicPortHandler {\n  constructor(protected portPromise: Promise<IWorkerMessagePort>, messageTransformer: IMessageTransformer) {\n    super(undefined, messageTransformer);\n  }\n\n  public async terminate(): Promise<void> {\n    await this.ensurePort();\n    this.portPromise = undefined;\n    return super.terminate();\n  }\n\n  protected async postMessage(msg: any, transferables: Transferable[]): Promise<void> {\n    await this.ensurePort();\n    return super.postMessage(msg, transferables);\n  }\n\n  protected async ensurePort(): Promise<void> {\n    if (!this.port && this.portPromise) {\n      this.port = await this.portPromise;\n      this.port.onmessage = this.handleMessage.bind(this);\n    }\n  }\n}\n","import { IMessageTransformer, Transferable } from \"../messageTransformers/IMessageTransformer\";\nimport { AsyncPortHandler } from \"./AsyncPortHandler\";\nimport { IWorkerMessagePort } from \"./IPortHandler\";\n\nexport class LazyPortHandler extends AsyncPortHandler {\n  constructor(private portFactory: () => Promise<IWorkerMessagePort>, messageTransformer: IMessageTransformer) {\n    super(undefined, messageTransformer);\n  }\n\n  public async terminate(): Promise<void> {\n    await this.ensurePort();\n    this.portFactory = undefined;\n    return super.terminate();\n  }\n\n  protected async postMessage(msg: any, transferables: Transferable[]): Promise<void> {\n    await this.ensurePort();\n    return super.postMessage(msg, transferables);\n  }\n\n  protected async ensurePort(): Promise<void> {\n    if (!this.portPromise && this.portFactory) {\n      this.portPromise = this.portFactory();\n    }\n\n    return super.ensurePort();\n  }\n}\n","import { DefaultMessageTransformer } from \"./messageTransformers/defaultMessageTransformer\";\nimport { IMessageTransformer } from \"./messageTransformers/IMessageTransformer\";\nimport { AsyncPortHandler } from \"./port/AsyncPortHandler\";\nimport { BasicPortHandler } from \"./port/BasicPortHandler\";\nimport { IPortHandler, IWorkerMessagePort } from \"./port/IPortHandler\";\nimport { LazyPortHandler } from \"./port/LazyPortHandler\";\n\nexport class ServiceMap {\n  public services: Map<string, any>;\n  public ports: IPortHandler[];\n\n  constructor(private messageTransformer: IMessageTransformer = new DefaultMessageTransformer()) {\n    this.services = new Map<string, any>();\n    this.ports = [];\n  }\n\n  public addPort(port: IWorkerMessagePort | Promise<IWorkerMessagePort> | (() => Promise<IWorkerMessagePort>)) {\n    let handler;\n    if (typeof port === \"function\") {\n      handler = new LazyPortHandler(port, this.messageTransformer);\n    } else if (port instanceof Promise) {\n      handler = new AsyncPortHandler(port, this.messageTransformer);\n    } else {\n      handler = new BasicPortHandler(port, this.messageTransformer);\n    }\n\n    handler.setCallHandler(this.handleCall.bind(this));\n    this.ports.push(handler);\n    return handler;\n  }\n\n  public terminatePort(handler: IPortHandler): void {\n    this.ports.splice(this.ports.indexOf(handler), 1);\n    // noinspection JSIgnoredPromiseFromCall\n    handler.terminate();\n  }\n\n  public addServiceObject(name, obj: any) {\n    return this.services.set(name, obj);\n  }\n\n  public async handleCall(service: string, method: string, args: any[]) {\n    const serviceObj = this.services.get(service);\n    if (serviceObj !== undefined) return await serviceObj[method](...args);\n\n    // We don't know about this service at all...\n    throw new Error(\"Service not found\");\n  }\n}\n","import { IMessageTransformer, Transferable } from \"./IMessageTransformer\";\n\nfunction transformError(err) {\n  return {\n    message: err.message,\n    name: err.name,\n    stack: err.stack,\n  };\n}\n\nexport class AutoTransferrableMessageTransformer implements IMessageTransformer {\n  public transformMessage(message: any): [any, Transferable[]] {\n    return this.transform(message, new Map<any, boolean>()).slice(0, 2) as [any, Transferable[]];\n  }\n\n  private transform(message: any, copies: Map<any, any>): [any, Transferable[], boolean] {\n    if (message && typeof message === \"object\") {\n      if (copies.has(message)) {\n        return [copies.get(message), [], true];\n      }\n\n      switch (Object.prototype.toString.call(message)) {\n        case \"[object ArrayBuffer]\":\n        case \"[object Uint8Array]\":\n        case \"[object Int8Array]\":\n        case \"[object Uint16Array]\":\n        case \"[object Int16Array]\":\n        case \"[object Uint32Array]\":\n        case \"[object Int32Array]\":\n        case \"[object Float32Array]\":\n        case \"[object Float64Array]\":\n          if (message.buffer.byteLength === message.byteLength) {\n            return [message, [message.buffer], false];\n          }\n          const copy = new message.constructor(message);\n          copies.set(message, copy);\n          return [copy, [copy.buffer], true];\n        case \"[object Blob]\":\n        case \"[object File]\":\n          return [message, [], false];\n        case \"[object Array]\":\n          const arrRes = message.map((e) => this.transform(e, copies));\n          const copiedArr = arrRes.reduce((a, c) => a || c, false);\n          const arrTransferables = arrRes.reduce((a, c) => a.concat(c[1]), []);\n\n          if (copiedArr) {\n            const copyArr = arrRes.map((a) => a[0]);\n            copies.set(message, copyArr);\n            return [copyArr, arrTransferables, true];\n          }\n          return [message, arrTransferables, false];\n        case \"[object Promise]\":\n        case \"[object XMLHttpRequest]\":\n        case \"[object Event]\":\n          throw new Error(\"CommunicationErrorNonMessageableValue\");\n        case \"[object DOMError]\":\n        case \"[object DOMException]\":\n          const copyDOMError = transformError(message);\n          copies.set(message, copyDOMError);\n          return [copyDOMError, [], true];\n        default:\n          if (message instanceof Error) {\n            const copyError = transformError(message);\n            copies.set(message, copyError);\n            return [copyError, [], true];\n          }\n\n          if (message instanceof Date) {\n            return [message, [], false];\n          }\n\n          const resObj = {};\n          let transferrables = [];\n          for (const key of Object.keys(message)) {\n            if (!key.startsWith(\"_\")) {\n              const cRes = this.transform(message[key], copies);\n              transferrables = transferrables.concat(cRes[1]);\n              resObj[key] = cRes[0];\n            }\n          }\n          copies.set(message, resObj);\n          return [resObj, transferrables, true];\n      }\n    }\n    return [message, [], false];\n  }\n}\n","import { DeferredPromise } from './deferredPromise';\nimport { DefaultMessageTransformer } from './messageTransformers/defaultMessageTransformer';\nimport { IMessageTransformer } from './messageTransformers/IMessageTransformer';\nimport { AsyncPortHandler } from './port/AsyncPortHandler';\nimport { IWorkerMessagePort, IPortHandler } from './port/IPortHandler';\nimport { RemoteService } from './remoteService';\nimport { ServiceMap } from './serviceMap';\n\nexport class MultiRemoteService<T extends RemoteService> {\n  private busyPorts: T[];\n  private freePorts: IPortHandler[];\n\n  private queue: Array<DeferredPromise<IPortHandler>>;\n\n  constructor(\n    private serviceMap: ServiceMap,\n    private portFactory: () => Promise<IWorkerMessagePort>,\n    private proxyType: new (ph: IPortHandler) => T,\n    private maxPorts: number,\n    private minPorts: number = 0,\n    private messageTransformer: IMessageTransformer = new DefaultMessageTransformer(),\n    private reuseRemotes: boolean = true,\n  ) {\n    this.busyPorts = [];\n    this.freePorts = [];\n    this.queue = [];\n  }\n\n  public spinUp() {\n    while (this.freePorts.length < this.minPorts) {\n      this.releasePort(this.getNewPort());\n    }\n  }\n\n  public async getRemote(): Promise<T> {\n    let portHandler: IPortHandler;\n    if (this.busyPorts.length >= this.maxPorts) {\n      const prom = new DeferredPromise<IPortHandler>();\n      this.queue.push(prom);\n      portHandler = await prom.promise;\n    } else if (this.freePorts.length > 0) {\n      portHandler = this.freePorts.shift();\n    } else {\n      portHandler = this.getNewPort();\n    }\n\n    const remote = new this.proxyType(portHandler);\n    this.busyPorts.push(remote);\n\n    return remote;\n  }\n\n  public releaseRemote(remote: T): void {\n    const portHandler = remote.detach();\n\n    this.busyPorts.splice(this.busyPorts.indexOf(remote), 1);\n\n    this.releasePort(portHandler);\n  }\n\n  private releasePort(portHandler: IPortHandler): void {\n    if (this.queue.length > 0) {\n      const deferred = this.queue.shift();\n      if (this.reuseRemotes) {\n        deferred.resolve(portHandler);\n      } else {\n        // noinspection JSIgnoredPromiseFromCall\n        portHandler.terminate();\n        deferred.resolve(this.getNewPort());\n      }\n    } else if (this.freePorts.length < this.minPorts) {\n      if (this.reuseRemotes) {\n        this.freePorts.push(portHandler);\n      } else {\n        // noinspection JSIgnoredPromiseFromCall\n        portHandler.terminate();\n        this.freePorts.push(this.getNewPort());\n      }\n    } else {\n      // noinspection JSIgnoredPromiseFromCall\n      portHandler.terminate();\n    }\n  }\n\n  private getNewPort() {\n    const ph = new AsyncPortHandler(this.portFactory(), this.messageTransformer);\n    ph.setCallHandler(this.serviceMap.handleCall.bind(this.serviceMap));\n    return ph;\n  }\n}\n","import { IMessageTransformer, Transferable } from \"../messageTransformers/IMessageTransformer\";\nimport { BasicPortHandler } from \"./BasicPortHandler\";\n\nexport class WorkerGlobalPortHandler extends BasicPortHandler {\n    constructor(messageTransformer: IMessageTransformer) {\n        super(null, messageTransformer);\n\n        (self as DedicatedWorkerGlobalScope).onmessage = this.handleMessage.bind(this);\n    }\n\n    public terminate(): Promise<void> {\n        throw new Error(\"ParentNotTerminableFromWorker\");\n    }\n\n    protected async postMessage(msg: any, transferables: Transferable[]): Promise<void> {\n        return (self as DedicatedWorkerGlobalScope).postMessage(msg, transferables);\n    }\n}\n","import { IPortHandler } from \"./port/IPortHandler\";\n\nexport class RemoteService<PortType extends IPortHandler = IPortHandler> {\n    public name: string;\n\n    constructor(private port: PortType) { }\n\n    public call(method, args = []) {\n        if (this.port === undefined) {\n            throw new Error(\"RemoteDetached\");\n        }\n\n        return this.port.call(this.name, method, args);\n    }\n\n    public detach(): PortType {\n        const port = this.port;\n        this.port = undefined;\n        return port;\n    }\n}\n","import { DefaultMessageTransformer } from \"./messageTransformers/defaultMessageTransformer\";\nimport { IMessageTransformer } from \"./messageTransformers/IMessageTransformer\";\nimport { isPortHandler } from \"./port/IPortHandler\";\nimport { ServiceMap } from \"./serviceMap\";\n\nexport class WorkerServiceManager extends ServiceMap {\n  constructor(\n    localServiceMap,\n    remoteServiceMap,\n    messageTransformer: IMessageTransformer = new DefaultMessageTransformer(),\n  ) {\n    super(messageTransformer);\n\n    localServiceMap.forEach((obj, name) => this.addServiceObject(name, obj));\n\n    remoteServiceMap.forEach((serviceProxyTypes, port) => {\n      const portHandler = isPortHandler(port) ? port : this.addPort(port);\n\n      serviceProxyTypes.forEach((serviceProxyInfo) => {\n        const proxy = new serviceProxyInfo[1](portHandler);\n        proxy.name = serviceProxyInfo[0];\n        this.addServiceObject(serviceProxyInfo[0], proxy);\n      });\n    });\n  }\n}\n\nexport { AutoTransferrableMessageTransformer } from \"./messageTransformers/autoTransferrableMessageTransformer\";\nexport { DefaultMessageTransformer } from \"./messageTransformers/defaultMessageTransformer\";\nexport { MultiRemoteService } from \"./multiRemoteService\";\nexport { AsyncPortHandler } from \"./port/AsyncPortHandler\";\nexport { BasicPortHandler } from \"./port/BasicPortHandler\";\nexport { IPortHandler, IWorkerMessagePort } from \"./port/IPortHandler\";\nexport { LazyPortHandler } from \"./port/LazyPortHandler\";\nexport { WorkerGlobalPortHandler } from \"./port/WorkerGlobalPortHandler\";\nexport { RemoteService } from \"./remoteService\";\n\n"],"names":["transformError"],"mappings":"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"}